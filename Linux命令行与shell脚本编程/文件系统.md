[toc]

# Linux文件系统
## 基本Linux文件系统
1. ext文件系统
2. ext2文件系统
## 日志文件系统
先将文件的更改写入到临时文件(称作日志,journal)中，在数据成功写到存储设备和索引节点表之后，再删除对应的日志条目

3钟日志方法
|方法|描述|
|-|-|
|数据模式|索引节点和文件都会被写入日志；丢失数据风险低，但性能差|
|有序模式|只有索引节点数据会被写入日志，但只有数据成功写入后才删除；在性能和安全性之间取得了良好的折中|
|回写模式|只有索引节点数据会被写入日志，但不控制文件数据何时写入；丢失数据风险高，但仍比不用日志好|
## 写时复制文件系统
写时复制利用快照兼顾了安全性和性能；如果要修改数据，会使用克隆或可写快照。修改过的数据并不会直接覆盖当前数据，而是被放入文件系统中的另一个位置中。即便是数据修改已经完成，之前的旧数据也不会被重写
# 操作文件系统
##创建分区
`fdisk`用来帮助管理安装在系统上的任何存储设备上的分区，必须指定要分区的存储设备的设备名，另外还得有超级用户权限
|命令|描述|
|-|-|
|a|设置活动分区标志|
|b|编辑BSD Unix系统用的磁盘标签|
|c|设置DOS兼容标志|
|d|删除分区|
|l|显示可用的分区类型|
|m|显示命令选项|
|n|添加一个新分区|
|o|创建DOS分区表|
|p|显示当前分区表|
|q|退出，不保存更改|
|s|为Sun Unix系统创建一个新磁盘标签|
|t|修改分区的系统ID|
|u|改变使用的存储单位|
|v|验证分区表|
|w|将分区表写入磁盘|
|x|高级功能|
常用指令：
1. 使用`p`命令将一个存储设备的详细信息显示出来
2. 使用`n`命令在该存储设备上创建新的分区
3. 使用`w`命令将更改保存到存储设备上
##创建文件系统
|工具|用途|
|-|-|
|mkefs|创建一个ext文件系统|
|mke2fs|创建一个ext2文件系统|
|mkfs.ext3|创建一个ext3文件系统|
|mkfs.ext4|创建一个ext4文件系统|
|mkreiserfs|创建一个ReiserFS文件系统|
|jfs_mkfs|创建一个JFS文件系统|
|mkfs.xfs|创建一个XFS文件系统|
|mkfs.zfs|创建一个ZFS文件系统|
|mkfs.btrfs|创建一个Btrfs文件系统|
## 挂载文件系统
```bash
ls /mnt
sudo mkdir /mnt/my_partition #创建挂载点
ls -al /mnt/my_partition/
ls -dF /mnt/my_partition
sudo mount -t ext4 /dev/sdb1 /mnt/my_partition #挂载
```
这种挂载文件系统的方法只能临时挂载文件系统；当重启Linux系统时，文件系统并不会自动挂载，要强制Linux在启动时自动挂载新的文件系统，可以将其添加到`/etc/fstab`文件
## 文件系统的检查与修复
`fsck`命令能够检查和修复大部分类型的Linux文件系统
```bash
fsck options filesystem
```
`fsck`命令使用`/etc/fstab`文件来自动决定正常挂载到系统上的存储设备的文件系统。如果存储设备尚未挂载，需要用`-t`命令行选项来指定文件系统类型
|选项|描述|
|-|-|
|-a|如果检测到错误，自动修复文件系统|
|-A|检查`/etc/fstab`文件中列出的所有文件系统|
|-C|给支持进度条功能的文件系统显示一个进度条(只有ext2和ext3)|
|-N|不进行检查，只显示哪些检查会执行|
|-r|出现错误时提示|
|-R|使用-A选项时跳过根文件系统|
|-s|检查多个文件系统时，依次进行检查|
|-t|指定要检查的文件系统类型|
|-T|启动时不显示头部信息|
|-V|在检查时产生详细输出|
|-y|检测到错误时自动修复文件系统|
只能在未挂载的文件系统上运行`fsck`命令；对大多数文件系统来说，只需卸载文件系统进行检查，检查完成之后重新挂载就好
