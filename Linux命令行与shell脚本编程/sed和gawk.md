[toc]

# 文本处理
## sed编辑器
sed编辑器被称为流编辑器，会在编辑器处理数据之前基于预先提供的一组规则来编辑数据流
sed编辑器可以根据命令来处理数据流中的数据，这些命令要么从命令行中输入，要么存储在一个命令文本文件中
sed编辑器会执行下列操作：
1. 一次从输入中读取一行数据
2. 根据所提供的编辑器命令匹配数据
3. 按照命令修改流中的数据
4. 将新的数据输出到STDOUT

在流编辑器将所有命令与一行数据匹配完毕后，它会读取下一行数据并重复这个过程。在流编辑器处理完流中的所有数据行后，它就会终止
由于命令是按顺序逐行给出的，sed编辑器只需对数据流进行一遍处理就可以完成编辑操作

命令格式
```bash
sed options script file
```
|选项|描述|
|-|-|
|-e script|在处理输入时，将script中指定的命令添加到已有的命令中|
|-f file|在处理输入时，将file中指定的命令添加到已有的命令中|
|-n|不产生命令输出，使用print命令来完成输出|
script参数指定了应用于流数据上的单个命令。如果需要用多个命令，要么使用`-e`选项在命令行中指定，要么使用`-f`选项在单独的文件中指定
1. 在命令行定义编辑器命令

默认情况下，sed编辑器会将指定的命令应用到STDIN输入流上，从而可以直接将数据通过管道输入sed编辑器处理
```bash
echo "This is a test" | sed 's/test/big test'
```
`s`命令会用斜线间指定的第二个文本字符串来替换第一个文本字符串模式

2. 在命令行使用多个编辑器命令

要在sed命令行上执行多个命令时，只要用`-e`选项就可以
```bash
sed -e '/s/brown/green/; s/dog/cat/' data1.txt
```
两个命令都作用到文件中的每行数据上，命令之间必须用分号隔开，并且在命令末尾和分号之间不能有空格

3. 从文件中读取编辑器命令

如果有大量要处理的`sed`命令，将它们放进一个单独的文件中通常会更方便一些，`sed`命令中用`-f`选项来指定文件
```bash
# script1.sed
# s/brown/green/
# s/fox/elephant/
# s/dog/cat/

sed -f script1.sed data1.txt
```
在这种情况下，不用在每条命令后面放一个分号，sed编辑器知道每行都是一条单独的命令，跟在命令行输入命令一样，sed编辑器会从指定文件中读取命令，并将它们应用到数据文件中的每一行上

## `gawk`程序
可以做如下的事情：
1. 定义变量来保存数据；
2. 使用算术和字符串操作符来处理数据；
3. 使用结构化编程概率(比如if-then语句和循环)来为数据处理增加处理逻辑；
4. 通过提取数据文件中的数据元素，将其重新排列或格式化，生成格式化报告
`gawk`程序的报告生成能力通常用来从大文本文件中提取数据元素，并将它们格式化成可读的报告
最完美的例子是格式化日志文件，在日志文件中找到错误行会很难，`gawk`程序可以让你从日志文件中过滤出需要的数据元素，然后你可以将其格式化，使得重要的数据更易于阅读
1. `gawk`命令格式

```bash
gawk options program file
```
|选项|描述|
|-|-|
|-F fs|指定行汇总划分数据字段的字段分隔符|
|-f file|从指定的文件中读取程序|
|-v var=value|定义gawk程序中的一个变量及其默认值|
|-mf N|指定要处理的数据文件中的最大字段数|
|-mr N|指定数据文件中的最大数据行数|
|-W keyword|指定gawk的兼容模式或警告等级|

2. 从命令行读取程序脚本

`gawk`程序脚本用一对花括号来定义，你必须将脚本命令放到两个花括号({})中
```bash
gawk '{print "Hello world"}'
```
`gawk`需要从命令行或者文件接收输入，才能运行
使用Ctrl+D组合键会在bash中产生一个EOF字符，终止该`gawk`命令

3. 使用数据字段变量

`gawk`的主要特性之一是其处理文本文件中数据的能力。它会自动给一行中的每个数据元素分配一个变量。默认情况下，`gawk`会将如下变量分配给它在文本行中发现的数据字段：
(1)$0代表整个文本行；

(2)$1代表文本行中的第1个数据字段；

(3)$2代表文本行中的第2个数据字段；

(4)$n代表文本行中的第n个数据字段；
在文本行中，每个数据字段都是通过字段分隔符划分的，`gawk`在读取一行文本时，会用预定义的字段分隔符划分每个数据字段，`gawk`中默认的字段分隔符是任意的空白字符(例如空格或制表符)

如果读取采用其他字段分隔符的文件，使用`-F`选项指定
```bash
gawk -F: `{print $1}` /etc/passwd
```
4. 在程序脚本中使用多个命令


`gawk`允许你将多条命令组合成一个正常的程序，要在命令行上的程序脚本中使用多条命令，只要在命令之间放个分号即可
```bash
echo "My name is Rich" | gawk '{$4="Christine"; print $0}'
```
5. 从文件中读取程序

`gawk`编辑器允许将程序存储到文件中，然后再在命令行中引用
```bash
# script2.gawk
# {print $1 "'s home directory is " $6}
gawk -F: -f script2.gawk /etc/passwd
```
多条指令，只要一条命令放一行即可，不需要用分号
```bash
# script3.gawk
# {
# text = "'s home directory is "
# print $1 text $6
# }
gawk -F: -f script3.gawk /etc/passwd
```
6. 在处理数据前运行脚本

`gawk`允许指定程序脚本何时运行，默认请看下，`gawk`会从输入中读取一行文本，然后针对该行的数据执行程序脚本，通过`BEGIN`关键字强制`gawk`在读取数据前执行`BEGIN`关键字后指定的程序脚本
```bash
gawk 'BEGIN {print "The data3 File Contents:"} {print $0}' data3.txt
``` 
7. 在处理数据后运行脚本
`END`关键字允许你指定一个程序脚本，`gawk`会在读完数据后执行它
```bash
# script4.gawk
# BEGIN{
# print "The latest list of users and shells"
# print " UserID \t Shell"
# print "--------- \t ----------"
# FS=":"   
# }
#
# {
# print $1 "     \t " $7   
# }
#
# END{
# print "This concludes the listing"   
# }

gawk -f script4.gawk /etc/passwd
```
# sed编辑器基础
## 更多的替换选项
1. 替换标记

默认情况下只替换每行中出现的第一处，要让替换命令能够替换一行中不同地方出现的文本必须使用替换标记，替换标记在替换命令字符串之后设置
```
s/pattern/replacement/flags
```
有4钟可用的替换标记：
(1) 数字，表明新文本将替换第几处模式匹配的地方
(2) g，表明新文本将会替换所有匹配的文本；
(3) p，表明原先行的内容要打印出来；
(4) w file，将替换的结果写到文件中；